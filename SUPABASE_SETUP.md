# Инструкция по интеграции с Supabase

## Шаг 1: Создание проекта в Supabase

1. Перейдите на [supabase.com](https://supabase.com)
2. Зарегистрируйтесь или войдите в аккаунт
3. Нажмите "New Project"
4. Выберите организацию и введите данные проекта:
   - **Name**: `multiplayer-game` (или любое другое имя)
   - **Database Password**: создайте надежный пароль
   - **Region**: выберите ближайший регион
5. Нажмите "Create new project"
6. Дождитесь создания проекта (1-2 минуты)

## Шаг 2: Настройка базы данных

1. В панели Supabase перейдите в **SQL Editor**
2. Скопируйте содержимое файла `supabase_setup.sql`
3. Вставьте SQL код в редактор и нажмите **Run**
4. Убедитесь, что таблица `players` создана успешно

## Шаг 3: Получение API ключей

1. Перейдите в **Settings** → **API**
2. Скопируйте следующие значения:
   - **Project URL** (например: `https://your-project-id.supabase.co`)
   - **anon public** ключ
   - **service_role** ключ (для backend)

## Шаг 4: Настройка переменных окружения

### Для React приложения:
1. Откройте файл `src/lib/supabase.js`
2. Замените `YOUR_SUPABASE_URL` на ваш Project URL
3. Замените `YOUR_SUPABASE_ANON_KEY` на ваш anon public ключ

### Для Python backend:
1. Создайте файл `.env` в корне проекта backend
2. Добавьте следующие переменные:
```
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your_anon_key_here
SUPABASE_SERVICE_KEY=your_service_key_here
```

## Шаг 5: Включение Realtime

1. В Supabase перейдите в **Database** → **Replication**
2. Найдите таблицу `players`
3. Включите переключатель для Realtime
4. Нажмите **Save**

## Шаг 6: Настройка Row Level Security (RLS)

RLS уже настроен в SQL скрипте, но вы можете дополнительно настроить политики:

1. Перейдите в **Authentication** → **Policies**
2. Найдите таблицу `players`
3. Убедитесь, что политика "Allow all operations on players" активна

## Шаг 7: Тестирование интеграции

1. Запустите backend сервер с новыми переменными окружения
2. Откройте игру в браузере
3. Проверьте в Supabase **Table Editor** → `players`, что данные сохраняются
4. Откройте игру в нескольких вкладках для тестирования синхронизации

## Дополнительные возможности

### Мониторинг в реальном времени
- В Supabase перейдите в **Logs** для просмотра активности
- Используйте **Database** → **Table Editor** для просмотра данных

### Аналитика
- Настройте **Analytics** для отслеживания использования
- Мониторьте производительность запросов

### Безопасность
- Настройте более строгие RLS политики при необходимости
- Используйте аутентификацию для идентификации игроков

## Структура таблицы players

| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | Уникальный идентификатор игрока |
| session_id | TEXT | ID сессии WebSocket |
| name | VARCHAR(50) | Имя игрока |
| x | INTEGER | Позиция X на игровом поле |
| y | INTEGER | Позиция Y на игровом поле |
| color | VARCHAR(7) | Цвет игрока в формате HEX |
| created_at | TIMESTAMP | Время создания записи |
| last_update | TIMESTAMP | Время последнего обновления |

## Преимущества использования Supabase

1. **Realtime синхронизация**: Автоматическое обновление данных между клиентами
2. **Масштабируемость**: Поддержка большого количества одновременных игроков
3. **Надежность**: Автоматические бэкапы и высокая доступность
4. **Простота**: Готовые API и SDK для быстрой интеграции
5. **Мониторинг**: Встроенные инструменты для отслеживания производительности

## Устранение неполадок

### Ошибка подключения
- Проверьте правильность URL и ключей API
- Убедитесь, что проект Supabase активен

### Данные не синхронизируются
- Проверьте настройки Realtime для таблицы `players`
- Убедитесь, что RLS политики настроены правильно

### Медленная работа
- Проверьте индексы в таблице
- Мониторьте использование ресурсов в Supabase Dashboard

